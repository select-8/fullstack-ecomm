[![Build Status](https://travis-ci.org/select-8/fullstack-ecomm.svg?branch=master)](https://travis-ci.org/select-8/fullstack-ecomm)

# GoS

# FULLSTACK DJANGO ECOMMERCE PROJECT

## Project Overview

The project presented [here](https://greenlit-flaskapp.herokuapp.com/) is an imagined e-commerce site. The people at GoS are in the business of selling comics and graphic novels, toys and collectables related to comics and graphic novels, and some classic and modern Sci-Fi novels. A real world version would be something like [Forbidden Planet](https://forbiddenplanet.com/).

I would imagine the store to have a long standing high street presence, with one or two stores in couple of cities around the country. This site represents their first entry to the online market.

The goals of this project are to:

- Continue to develop general Python skills.
- Get some experience in a fullstack framework like Django.
- Work with relational DB systems using the Django ORM.
- To further my experience of deployment to Heroku.
- To work with the Strip API.
- To keep my models and apps relativley simple while allowing for future complexity.
- to make it a plesent experience for a user.


### User Stories

 ##### As a user I want to ...
  - quickly understand whats on offer at this site.
  - search for items I'm interested in.
  - filter the content presented by category i.e. I'm here to look at comics, I dont need to see toys.
  - be navigatation of the site to be easy and intuative. 
  - sort items by price (high-to-low and low-to-high).
  - access to detailed information about products.
  - add products to a cart as I browse.
  - be able to access my cart easily.
  - be able to edit my cart by adding or deleting items.
  - be able to register for the site.
  - know if I am logged in, some personalisation. 
  - be able to leave a comments and ratings for products.
  - see what others have said about products.
  - see an average of all ratings for each product.
  - know if an item is in stock or not, this should include items in cart(s).
  - be able to log out.


### Data Model

The data schema is constructed through the Django ORM. Data is stored in a locally hosted SQLITE instance for development and in a remote PostgreSQL instance when deployed for production.


#### Category

Each product is one of three possible categories

                                    Table "public.products_category"
        Column  |         Type          | Collation | Nullable |             Default              
        ----------+-----------------------+-----------+----------+----------------------------------
        id       | bigint                |           | not null | generated by default as identity
        category | character varying(80) |           | not null | 
        Indexes:
            "products_category_pkey" PRIMARY KEY, btree (id)
        Referenced by:
            TABLE "products_brand" CONSTRAINT "products_brand_category_id_fkey" FOREIGN KEY (category_id) REFERENCES products_category(id)
            TABLE "products_kind" CONSTRAINT "products_kind_category_id_fkey" FOREIGN KEY (category_id) REFERENCES products_category(id)
            TABLE "products_product" CONSTRAINT "products_product_category_id_fkey" FOREIGN KEY (category_id) REFERENCES products_category(id)

#### Product
The main model for all products.
Note: kind_id and views are not utilised in this project but may be in the future.

- id: PK
- name, description, price and image are static fileds, simply rendered, they don't change on user interaction with site.
- category_id: 1-M FK constraint
- stock: count of physical instances of this product
- cart_stock: count of physical instances of this product less whats currently in carts
- sales: amount of this product which has cleared through checkout


                                        Table "public.products_product"
        Column    |          Type          | Collation | Nullable |             Default              
        -------------+------------------------+-----------+----------+----------------------------------
        id          | bigint                 |           | not null | generated by default as identity
        name        | character varying(254) |           | not null | 
        description | text                   |           | not null | 
        price       | numeric                |           | not null | 
        image       | character varying(100) |           | not null | 
        views       | bigint                 |           | not null | 
        category_id | bigint                 |           | not null | 
        kind_id     | bigint                 |           | not null | 
        stock       | bigint                 |           | not null | 
        sales       | bigint                 |           | not null | 
        cart_stock  | bigint                 |           | not null | 
        Indexes:
            "products_product_pkey" PRIMARY KEY, btree (id)
            "products_product_category_id_9b594869" btree (category_id)
            "products_product_kind_id_027afdd1" btree (kind_id)
        Foreign-key constraints:
            "products_product_category_id_fkey" FOREIGN KEY (category_id) REFERENCES products_category(id)
            "products_product_kind_id_fkey" FOREIGN KEY (kind_id) REFERENCES products_kind(id)
        Referenced by:
            TABLE "checkout_orderlineitem" CONSTRAINT "checkout_orderlineitem_product_id_fkey" FOREIGN KEY (product_id) REFERENCES products_product(id)
            TABLE "reviews_review" CONSTRAINT "reviews_review_product_id_fkey" FOREIGN KEY (product_id) REFERENCES products_product(id)

#### Review

 - id: PK
 - product_id: 1-M FK constraint
 - user_id: 1-1 FK constraint
 - created: timestamp crated on submission of review form
 - comment: users comment
 - rating: users rating


                                        Table "public.reviews_review"
        Column   |            Type             | Collation | Nullable |             Default              
        ------------+-----------------------------+-----------+----------+----------------------------------
        id         | bigint                      |           | not null | generated by default as identity
        comment    | character varying(254)      |           | not null | 
        created    | timestamp without time zone |           | not null | 
        product_id | bigint                      |           | not null | 
        user_id    | bigint                      |           |          | 
        rating     | bigint                      |           | not null | 
        Indexes:
            "reviews_review_pkey" PRIMARY KEY, btree (id)
            "reviews_review_product_id_ce2fa4c6" btree (product_id)
            "reviews_review_user_id_875caff2" btree (user_id)
        Foreign-key constraints:
            "reviews_review_product_id_fkey" FOREIGN KEY (product_id) REFERENCES products_product(id)
            "reviews_review_user_id_fkey" FOREIGN KEY (user_id) REFERENCES auth_user(id)


### UX

#### System Architecture
![](static/images_rm/SysArch.jpg)

#### Wireframes

[Here](static/images_rm/)

#### Brand

I imagine the brand for this site to be a play on Sci-Fi tropes, i.e a bit mysterious and playful with the content but serious when getting to the real business. This idea should feed through the site content.

#### Typography

Cute Font is a cursive font. I choose this font initially as it renders the charcaters G O S in a way that makes them slightly ambiguous, they could be read as 6 0 5. I think this fits with the brand of the site.

With a font like this it is easy to overkill, to this end it is used sparingly and never in paragraph text.

Cute Font was used for:
 - Site Name
 - Product Name
 - Footer text

 Lato is sans serif. While being nicley readable, it is semi-rounded and therefore compliments the Cute text well. It also works well as bold text.

 Lato was used in:
 - Paragraphs
 - Category links
 - Buttons
 - Forms

#### Colour

Dark Black for the Navbar works well with the Purple used as the main background colour. While maintaining a dark shell shell around the lighter content, they are also distinct from each other.
The Purple is used to convey that sense of mystery as required by the site brand.

The cards are Bootstrap, with a White background colour and black text. The product name in Cute Font use the same Purple as the container background. Ive used a dark red to block out the card content.

The text outside of the cards is White, allowing for contrast with the darker background. The red is used again for < hr > elements.

![](static/images_rm/colours.png)



## Features
### Apps

- Home
- Products
- Cart
- Checkout
- Reviews
- Search
- Accounts


#### Navigation

The Navabr is made up of two elements. 
 1. A Bootstrap < nav > element
    - If user is logged in we display the user's username.
    - Brand name, links to home page.
    - Product catgory links. The 'path' element of the request is queried to display the relevent category as an "active" element.
    - Icons links to log in/out register
    - A count of cart items
 2. A Bootstrap < container-fluid > element
    - Search Bar
    - Browse All Products link
    - If viewing all products, a sort by price dropdown


#### User

Non logged in users have access to all features besides leaving a review.

Users can register via a simple form. Once registered users can reset their email address.

Logged in users have their name displayed in the Navbar, can add reviews and rating for products, logout.

#### Detailed Product Views

In the multi product views a products description is truncated to 10 words with a prompt to click for more information. This links to new page where the card is full width and the entirity of a product's information is displayed. On mobile screens, if a description goes over 120 characters it is again truncated with an option to display more. This triggers a dropdown rather than loading a new page.

A button to add items to your cart. The max quantity a user is allowed to add is rendered from the **cart_stock** value in the db.

We also display a form where logged in users can leave a comment and select a rating for a product. On submit the review is rendered ordered by timestamp.

#### Search / Filter / Sort

Search is full text query using Django **icontains** on the name and description fields for products.
Products can be filtered by category via links in the Navbar.
When in all products view, products can be sorted by price in both directions.

#### Pagination

All products and category views use Django pagination.

#### Stock

Each product has a value for **stock** and **cart_stock**.

For each item processed via the checkout, the quantity in the cart is subtracted from the stock value and the db is updated.
When the quantity of product added to the cart reaches the max total of **cart_stock** in the db, no more of that item can be added to the cart. Subsequently if a user removes or alters an items quantity when in the cart, this amount is added back onto the amount available to the users.
On successfull payment, **stock** and **cart_stock** are realigned in the db.

#### Sales
On the home page each carousel is displaying the top three sold items. The sales value is read from the db and updated on sucessful checkout.

#### Cart
Users can add items to their cart, view current cart, alter quantity of a cart item, remove an item from the cart.

#### Checkout
As with cart, users can add, edit and remove items. The checkout uses Stripe to process payments.

#### Review
Logged in users can leave review and rate products.

#### Left to Implement

The product model should have distinct classes for each category of product. With this in place each type of product could contain bespoke details, books can have authors and toys can have brand for example.

Stock control should be its own app to afford it more complexity. Currently the stock in a cart is only factored into the UX once it hit zero. In a future developement each tick of the quantity button would be calculated to give the user feedback.

## Testing

Besides checking data types, there is no automated testing.

Manual Testing through development of the site consisted of asking the following questions each time a significant feature was added, removed or changed. 

What happens:

    - when users click links, are they ever confused about where they are, do they have further options, can they always get home
        - logged in
        - not logged in
        - admin
        - after initial register
        - after logging out
    - when user enter incorrect username/password
    - when a user is newly registered
        - is the messaging correct
        - can they easily add a pitch
        - are their options re edits clear
        - does the edit function work
        - does the submit function work
    - at all times
        - are the dropdown options working?

The site deployed to Heroku was also periodically tested asking the above questions.

##### Users

The site was tested to see if each of the user stories outlined above were met.
In order to assess the sites usability I have shared it for testing with some fiends and collegues and resonded to feedback where possible.

##### Responsiveness

The site as vigorously tested in Chrome Developer Tools in responsive mode and at all screen sizes on a variety of device brands. This involved selecting _inspect_ and the _toggle device toolbar_ options. Then selecting through common devices (Galaxy S5, Google Pixel devices, iPhones of various sizes, iPad, iPad Pro) in order to see if my Bootstrap Grid set up allowed the text and charts to flow and flex without any visual or technical issues.
The site was also physically tested on a Samsung Galaxy Tab, an iPhone 6, a Windows Desktop machine and a Retina Screen MacBook Pro.

##### Browsers
The site was tested in Chrome, FireFox, Safari and Opera.
 
### Validation

CSS files where found to be valid via the offical W3 code validators.

CSS : https://jigsaw.w3.org/css-validator/

HTML has not been validated or commented as html as neither will work in a django template

JavaScript files were tested at : https://jshint.com/

Python was checked for Pep* compliance at : http://pep8online.com/

## Deployment

I used a 'walking the skelethon' approach, deploying early to Heroku.

The site is deployed to Heroku under the following process:

1. Create a local git respositry in your project
2. Push to Github
3. In Heroku, under Deploy - Deployment Method: Connect to GitHub
4. Follow guidlines to connect the app to the GitHub repo
5. Allow automatic deploys
6. Under setting - Reveal Config Vars
    - set the port to 0.0.0.0 - this opens your app to all IPS
    - set the port to what you want
    - debug to false
    - set the relevant MONGO URI
7. When code is pushed to GitHub it is automatically depolyed to the Heroku app
8. Once the project is built, launch the app and test

### How to clone locally

The site can be cloned from GitHub and ran locally by following the following steps:

- Go to my [repo](https://github.com/select-8/greenlit-flask-mongodb)
- Click the Clone or Download option
- Copy tyhe Url
- In your local environment, wherever you want to store the code do: 
    - git clone < the copied url >
- The repo will be downloaded
- cd into it in terminal
- Create yourself a virtual environment, I used pipenv
    - sudo pip3 install pipenv.
- To start the shell environment, do:
    - pipenv shell 
- Install project requirments using the requirments.txt file
    - pipenv install -r requirements.txt
- Create a .flaskenv file
    - touch .flaskenv
    - nano .flaskenv
        - FLASK_ENV=development
    - ctrl-X to prompt exit
    - y to save edit
- You can now run the project by doing:
    - flask run
    - open the app at http://127.0.0.1:5000/

However, you will not have access to the data. To got this you will need to create your own mongo instance and upload the dump files located [here](static/assets/greenlit) 
To do this you can used the mongoimport command:
            
    mongoimport --db <dbname> --collection <collection_name>
        --authenticationDatabase admin --username <user> --password <password> 
        --drop --file ~\path\to\files.json

Then set the MONGO_URI environment variable in a .env file

You should now be able to register and start adding pitches!

## Technologies Used

##### LANGUAGES
- [HTML](https://www.w3.org/html/)
- [CSS](https://www.w3.org/Style/CSS/Overview.en.html)
- [JavaScript](https://www.javascript.com/)
- SQL
- [Python](https://www.python.org/)

##### VERSION CONTROL
- [GIT](https://git-scm.com/)

##### Deployment
- [HEROKU](heroku.com)

##### Environment
- [pipenv](https://github.com/pypa/pipenv)

Create virtual python environments.

Use pipenv install ... to install project requirments 

A .flaskenv file with FLASK_ENV=development means your always in debug mode

##### FRAMEWORKS

- [Flask](https://palletsprojects.com/p/flask/)

    - Used to build the web application
    - Imports
        - session - to manage user sessions
        - flash - to display messages on user actions
        - render_template, redirect, url_for - used to navigate user to the correct end points
        - request - for query parameters
        - flask_pymongo - flask binding for mongodb
        - bcrypt - password encryption 
        - datetime - to parse time

- [Jinja](https://jinja.palletsprojects.com/en/2.10.x/templates/)

Templating engine used with flask to render html

- [Bootstrap](https://getbootstrap.com/)

To create a responsive grid

- [jQuery](https://jquery.com/)

To create the dropdown effect for pitches and do do tooltips

- [D3](https://d3js.org/)

To render the charts in the DOM as SVG

- [dc.js](https://dc-js.github.io/dc.js/)

Provided templates for the charts
- [crossfilter.js](https://square.github.io/crossfilter/)

Provides multidimentional filtering of data in dc charts

- [queue.js](https://github.com/d3/d3-queue)

Evaluates asynchronous tasks to handle callbacks

##### APIs
 - [Google Fonts](https://fonts.google.com/)

##### SOFTWARE AND SERVICES
- [Visual Studio Code](https://code.visualstudio.com/)
- [GitHub](https://github.com/)

##### Database
- [MongoDB](https://www.mongodb.com)

##### EDITORS
- SUBLIME
- ATOM

##### VMWARE
- UBUNTU V18.04

##### HARDWARE
- MAC OSX

##### PROJECT MGMT
- SLACK
- NOTION

## Credits

The flask and Jinja and mongodb documentation was used heavily.

The code to remove NULL rows from the results of a crossfilter was found [here](https://github.com/dc-js/dc.js/wiki/FAQ#remove-empty-bins)

